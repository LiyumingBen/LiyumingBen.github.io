<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mongodb | 记录生活点滴</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="记录生活点滴是Ben的个人博客，用于记录学习笔记、分享音乐、书籍、旅行等个人兴趣的站点。">
    <meta name="keywords" content="Ben,Ben的博客,博客,个人博客,vue,vuejs,vuepress,vuepress-theme-reco">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.1c487a6a.css" as="style"><link rel="preload" href="/assets/js/app.d79cf97e.js" as="script"><link rel="preload" href="/assets/js/2.c3fe4d6a.js" as="script"><link rel="preload" href="/assets/js/68.8946d160.js" as="script"><link rel="preload" href="/assets/js/4.35d88f9b.js" as="script"><link rel="prefetch" href="/assets/js/10.d906277b.js"><link rel="prefetch" href="/assets/js/11.5dae8151.js"><link rel="prefetch" href="/assets/js/12.319133fa.js"><link rel="prefetch" href="/assets/js/13.51afc771.js"><link rel="prefetch" href="/assets/js/14.5a0c144b.js"><link rel="prefetch" href="/assets/js/15.9317535d.js"><link rel="prefetch" href="/assets/js/16.f2d72803.js"><link rel="prefetch" href="/assets/js/17.b43aeffa.js"><link rel="prefetch" href="/assets/js/18.ec6c8aa3.js"><link rel="prefetch" href="/assets/js/19.62d1da9f.js"><link rel="prefetch" href="/assets/js/20.4c3ee2d7.js"><link rel="prefetch" href="/assets/js/21.e8d8a639.js"><link rel="prefetch" href="/assets/js/22.bbe5b14d.js"><link rel="prefetch" href="/assets/js/23.d471e689.js"><link rel="prefetch" href="/assets/js/24.cfc17311.js"><link rel="prefetch" href="/assets/js/25.0af02fb0.js"><link rel="prefetch" href="/assets/js/26.051764e6.js"><link rel="prefetch" href="/assets/js/27.bccc3771.js"><link rel="prefetch" href="/assets/js/28.ed4c27e8.js"><link rel="prefetch" href="/assets/js/29.066cfabf.js"><link rel="prefetch" href="/assets/js/3.d6f08142.js"><link rel="prefetch" href="/assets/js/30.16a6a1dd.js"><link rel="prefetch" href="/assets/js/31.eade2b23.js"><link rel="prefetch" href="/assets/js/32.37fdcf75.js"><link rel="prefetch" href="/assets/js/33.87d2cf6c.js"><link rel="prefetch" href="/assets/js/34.ddd384d3.js"><link rel="prefetch" href="/assets/js/35.4d748cf9.js"><link rel="prefetch" href="/assets/js/36.45857faf.js"><link rel="prefetch" href="/assets/js/37.9ab504f6.js"><link rel="prefetch" href="/assets/js/38.f56b35af.js"><link rel="prefetch" href="/assets/js/39.10040d8a.js"><link rel="prefetch" href="/assets/js/40.14f52156.js"><link rel="prefetch" href="/assets/js/41.bfc7b650.js"><link rel="prefetch" href="/assets/js/42.2ff43d97.js"><link rel="prefetch" href="/assets/js/43.b43c8d05.js"><link rel="prefetch" href="/assets/js/44.6195ffb5.js"><link rel="prefetch" href="/assets/js/45.c8c42619.js"><link rel="prefetch" href="/assets/js/46.a0f745ee.js"><link rel="prefetch" href="/assets/js/47.78f7d613.js"><link rel="prefetch" href="/assets/js/48.10e26f2d.js"><link rel="prefetch" href="/assets/js/49.8a0e048a.js"><link rel="prefetch" href="/assets/js/5.a04c4b05.js"><link rel="prefetch" href="/assets/js/50.26a14811.js"><link rel="prefetch" href="/assets/js/51.fdb6b500.js"><link rel="prefetch" href="/assets/js/52.3cf1c1cc.js"><link rel="prefetch" href="/assets/js/53.4ad60424.js"><link rel="prefetch" href="/assets/js/54.fe673b7c.js"><link rel="prefetch" href="/assets/js/55.4180f4c7.js"><link rel="prefetch" href="/assets/js/56.7a93c8ad.js"><link rel="prefetch" href="/assets/js/57.fcddde7d.js"><link rel="prefetch" href="/assets/js/58.ab4a5926.js"><link rel="prefetch" href="/assets/js/59.56c8dc09.js"><link rel="prefetch" href="/assets/js/6.d3630d9b.js"><link rel="prefetch" href="/assets/js/60.bfb1e83b.js"><link rel="prefetch" href="/assets/js/61.a37cbf71.js"><link rel="prefetch" href="/assets/js/62.df84c3f3.js"><link rel="prefetch" href="/assets/js/63.c426db67.js"><link rel="prefetch" href="/assets/js/64.1f2a498d.js"><link rel="prefetch" href="/assets/js/65.95afd93a.js"><link rel="prefetch" href="/assets/js/66.a4aec801.js"><link rel="prefetch" href="/assets/js/67.afa83146.js"><link rel="prefetch" href="/assets/js/69.4400e001.js"><link rel="prefetch" href="/assets/js/7.6e9d197a.js"><link rel="prefetch" href="/assets/js/70.192090ef.js"><link rel="prefetch" href="/assets/js/71.01c7c951.js"><link rel="prefetch" href="/assets/js/72.f318b4a6.js"><link rel="prefetch" href="/assets/js/73.5798cdc4.js"><link rel="prefetch" href="/assets/js/74.2d8c0403.js"><link rel="prefetch" href="/assets/js/75.2d3d8963.js"><link rel="prefetch" href="/assets/js/76.6a08bb6e.js"><link rel="prefetch" href="/assets/js/8.b679f372.js"><link rel="prefetch" href="/assets/js/9.69665598.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c487a6a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar have-rightmenu" data-v-f848d4e8><div class="global-loading-wrapper" data-v-2a9399d1 data-v-f848d4e8 data-v-f848d4e8><div class="loader-main" data-v-2a9399d1><img src="/assets/img/loading.18d75e19.gif" alt="loading" data-v-2a9399d1></div></div> <div class="hide" data-v-f848d4e8><header class="navbar" data-v-f848d4e8><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://pic1.58cdn.com.cn/nowater/fangfe/n_v291c36487fef1413eb9f62fc789eba2c6.jpg" alt="记录生活点滴" class="logo"> <span class="site-name">记录生活点滴</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">选择模式</h4> <ul class="color-mode-options"><li class="dark">
      深色模式
    </li><li class="light active">
      浅色模式
    </li><li class="read">
      阅读模式
    </li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <ul class="suggestions" style="display:none;"></ul></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i></i>前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>文档教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/docs/imooc/wiki/" class="nav-link"><i class="iconfont reco-blog"></i>慕课教程
</a></li><li class="dropdown-subitem"><a href="/web/docs/es6/" class="nav-link"><i class="iconfont reco-blog"></i>ES6 入门教程
</a></li><li class="dropdown-subitem"><a href="/web/docs/angular/" class="nav-link"><i class="iconfont reco-blog"></i>Angular 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/react/" class="nav-link"><i class="iconfont reco-blog"></i>React 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/vue/" class="nav-link"><i class="iconfont reco-blog"></i>Vue 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/node/" class="nav-link"><i class="iconfont reco-blog"></i>Node 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/babel/" class="nav-link"><i class="iconfont reco-blog"></i>Babel 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/webpack/" class="nav-link"><i class="iconfont reco-blog"></i>Webpack 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/typescript/" class="nav-link"><i class="iconfont reco-blog"></i>TypeScript 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/runoob/" class="nav-link"><i class="iconfont reco-blog"></i>菜鸟教程
</a></li><li class="dropdown-subitem"><a href="/web/docs/docschina/" class="nav-link"><i class="iconfont reco-blog"></i>印记中文
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link"><i class="iconfont reco-category"></i>分类
</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link"><i class="iconfont reco-tag"></i>标签
</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link"><i class="iconfont reco-date"></i>归档
</a></li></ul></div></div><div class="nav-item"><a href="/bookshop/message-board/" class="nav-link"><i class="iconfont reco-suggestion"></i>留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>联系</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/LiyumingBen" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/bookshop/linkme/" class="nav-link"><i class="iconfont reco-account"></i>关于我
</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/bookshop/friendslink/" class="nav-link"><i class="iconfont reco-friend"></i>友情链接
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-f848d4e8></div> <aside class="sidebar" data-v-f848d4e8><div class="personal-info-wrapper" data-v-22626576 data-v-f848d4e8><img src="https://pic1.58cdn.com.cn/nowater/fangfe/n_v291c36487fef1413eb9f62fc789eba2c6.jpg" alt="author-avatar" class="personal-img" data-v-22626576> <div class="author" data-v-22626576>
    Ben
  </div> <div class="personal-info-details" data-v-22626576><div data-v-22626576>文章：<span data-v-22626576>54</span></div> <div data-v-22626576>地点：<span data-v-22626576>北京·朝阳</span></div></div> <div class="slogan" data-v-22626576>
    开到荼蘼
  </div> <ul class="social-links" data-v-22626576><li class="social-item" data-v-22626576><i class="iconfont reco-github" style="color:#3eaf7c;" data-v-22626576></i></li><li class="social-item" data-v-22626576><i class="iconfont reco-juejin" style="color:#00a1d6;" data-v-22626576></i></li></ul></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i></i>前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>文档教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/docs/imooc/wiki/" class="nav-link"><i class="iconfont reco-blog"></i>慕课教程
</a></li><li class="dropdown-subitem"><a href="/web/docs/es6/" class="nav-link"><i class="iconfont reco-blog"></i>ES6 入门教程
</a></li><li class="dropdown-subitem"><a href="/web/docs/angular/" class="nav-link"><i class="iconfont reco-blog"></i>Angular 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/react/" class="nav-link"><i class="iconfont reco-blog"></i>React 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/vue/" class="nav-link"><i class="iconfont reco-blog"></i>Vue 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/node/" class="nav-link"><i class="iconfont reco-blog"></i>Node 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/babel/" class="nav-link"><i class="iconfont reco-blog"></i>Babel 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/webpack/" class="nav-link"><i class="iconfont reco-blog"></i>Webpack 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/typescript/" class="nav-link"><i class="iconfont reco-blog"></i>TypeScript 文档
</a></li><li class="dropdown-subitem"><a href="/web/docs/runoob/" class="nav-link"><i class="iconfont reco-blog"></i>菜鸟教程
</a></li><li class="dropdown-subitem"><a href="/web/docs/docschina/" class="nav-link"><i class="iconfont reco-blog"></i>印记中文
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link"><i class="iconfont reco-category"></i>分类
</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link"><i class="iconfont reco-tag"></i>标签
</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link"><i class="iconfont reco-date"></i>归档
</a></li></ul></div></div><div class="nav-item"><a href="/bookshop/message-board/" class="nav-link"><i class="iconfont reco-suggestion"></i>留言板
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>联系</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/LiyumingBen" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/bookshop/linkme/" class="nav-link"><i class="iconfont reco-account"></i>关于我
</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/bookshop/friendslink/" class="nav-link"><i class="iconfont reco-friend"></i>友情链接
</a></li></ul></li></ul></div></div> <!----></nav> <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-9"><div class="articleInfo-wrap" data-v-13f19dad><div class="articleInfo" data-v-13f19dad><ul class="breadcrumbs" data-v-13f19dad><li data-v-13f19dad><a href="/" title="首页" class="fa fa-laptop-house router-link-active" data-v-13f19dad></a></li> <li data-v-13f19dad><a href="/categories/?category=%E6%95%B0%E6%8D%AE%E5%BA%93" title="分类" data-v-13f19dad>数据库</a></li> <!----> <!----></ul> <div class="info" data-v-13f19dad><div title="作者" class="author fa fa-user" data-v-13f19dad><a href="javascript:;" data-v-13f19dad>Ben</a></div> <div title="创建时间" class="date fa fa-calendar-alt" data-v-13f19dad><a href="javascript:;" data-v-13f19dad>2022/04/05 10:31:35</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
            Mongodb
          </h1> <div class="theme-vdoing-content content__default"><h1 id="mongodb"><a href="#mongodb" class="header-anchor">#</a> Mongodb</h1> <h2 id="_1-安装并启动mongodb"><a href="#_1-安装并启动mongodb" class="header-anchor">#</a> 1.安装并启动Mongodb</h2> <ul><li><p>下载安装包并傻瓜式安装</p></li> <li><p>配置环境变量,将安装的mongodb路径添加在环境变量中去</p></li> <li><p>在C盘(或D盘等)的根目录下创建一个<code>data</code>文件夹,文件夹里面创建一个<code>db</code>文件夹(这是mongodb默认的路径)</p> <p>**注:**如果不想用默认路径可以自己选择一个空的文件夹创建<code>db</code>文件</p></li> <li><p>打开命令行窗口输入<code>mongod</code>启动mongdb服务器,默认在27017端口访问mongodb</p> <p><strong>注:</strong></p> <ul><li><p>如果只输入mongod就会使用默认的路径打开数据库,如果没有使用默认路径,需要使用</p> <p><code>mongod --dbpath 自己设置的数据库db目录路径</code></p></li> <li><p>如果不想在27017端口访问mongodb,可以在最后的路径后面<strong>输入空格再加上<code>--port 端口号</code></strong></p></li></ul></li> <li><p>重新打开一个cmd窗口(前面那个不要关闭 ),输入<code>mongo</code>链接mongodb,出现<code>&gt;</code>证明就能运行了</p></li></ul> <p><strong>数据库(database)</strong></p> <ul><li>数据库的服务器
<ul><li>服务器用来保存数据</li> <li><code>mongod</code>命令用于启动服务器</li></ul></li> <li>数据库的客户端
<ul><li>客户端用来操作服务器,对数据进行增删查改的操作</li> <li><code>mongo</code>用来启动客户端</li></ul></li></ul> <h2 id="_2-mongodb系统服务"><a href="#_2-mongodb系统服务" class="header-anchor">#</a> 2.Mongodb系统服务</h2> <p>将mongodb设置为系统服务,可以在后台启动,不需要每次都要手动启动</p> <ul><li><p>在C盘根目录下创建的data文件夹中创建db和log文件夹</p></li> <li><p>创建配置文件,在下载的mongdb目录中(与bin文件夹在同一层级),添加一个配置文件mongod.cfg,内容如下:</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>systemLog:
    destination: file
    path: c:\data\log\mongod.log
storage:
    dbPath: c:\data\db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>**注意:**path路径必须是要和前面的操作相对应</p></li> <li><p>然后以管理员身份打开cmd窗口,输入</p> <p><code>C:\mongodb安装目录\bin\mongo.exe --config &quot;C:\mongodb安装目录\mongod.cfg&quot; --install</code></p> <p><strong>例子:</strong><code>C:\mongodb\bin\mongod.exe --config &quot;C:\mongodb\mongod.cfg&quot; --install</code></p></li> <li><p>输入<code>net start MongoDB</code>启动mongodb服务(如果不生效，也可以打开任务管理器，找到相关服务，手动打开)</p> <p><img src="https://img-blog.csdn.net/20171226160812863" alt="img"></p></li></ul> <p><strong>相关操作</strong></p> <ul><li><code>net stop MongoDB</code>关闭服务</li> <li><code>sc.exe delete MongoDB</code>删除服务</li></ul> <h2 id="_3-基本概念"><a href="#_3-基本概念" class="header-anchor">#</a> 3.基本概念</h2> <ul><li>数据库(database)</li> <li>集合(collection)</li> <li>文档(document)</li></ul> <p>**注:**在mongodb中,数据库和集合都不需要手动创建,当我们创建文档时,如果文档所在的集合或数据库不存在会自动创建数据库和集合</p> <h3 id="_3-1-导入导出数据"><a href="#_3-1-导入导出数据" class="header-anchor">#</a> 3.1 导入导出数据</h3> <ul><li><p>在mongodb中可以使用<strong>mongodump</strong>命令来备份mongodb数据。该命令可以导出所有数据到指定目录.可通过参数指定导出到数据量级转存的服务器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#mongodump -h dbhost(IP端口号) -d dbname(数据库名称) -o dbdiectory(存储备份数据的目录)</span>
mongodump -h <span class="token number">127.0</span>.0.1 -d koa -o C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>asus<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>koaDb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>在mongodb中可以使用<strong>mongorestore</strong>命令可以用来恢复备份的数据</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#mongorestore -h dbhost -d dbname &lt;path&gt;</span>
mongorestore -h <span class="token number">127.0</span>.0.1 -d koademo C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>asus<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>koaDb<span class="token punctuation">\</span>koa
<span class="token comment">#因为在上面导出数据库的时候是导出一整个数据库文件夹,所以需要进入到里面拿到koa文件夹</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <h2 id="_4-指令"><a href="#_4-指令" class="header-anchor">#</a> 4.指令</h2> <h3 id="_4-1-基本指令"><a href="#_4-1-基本指令" class="header-anchor">#</a> 4.1 基本指令</h3> <ul><li><code>show dbs</code>和<code>show databases</code>——显示当前的所有数据库</li> <li><code>use 数据库名</code>——进入到指定的数据库中</li> <li><code>db</code>——表示当前所处的数据库</li> <li><code>show collections</code>——显示数据库中所有的集合</li></ul> <h3 id="_4-2-crud-增删改查-指令"><a href="#_4-2-crud-增删改查-指令" class="header-anchor">#</a> 4.2 CRUD(增删改查)指令</h3> <h4 id="_4-2-1-插入文档"><a href="#_4-2-1-插入文档" class="header-anchor">#</a> 4.2.1 插入文档</h4> <p><code>db.&lt;collection&gt;.insert()</code>,在insert()中接受一个对象或数组</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">19</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>**注意:**mongodb的属性值也可以是一个文档或一个数组,当一个文档的属性是文档时,我们说它是内嵌文档</p> <h4 id="_4-2-2-查询文档"><a href="#_4-2-2-查询文档" class="header-anchor">#</a> 4.2.2 查询文档</h4> <ul><li><p><code>db.&lt;collection&gt;.find()</code>,在find()可以接受一个对象作为条件参数,如果传入一个空对象就和不传一样会查找集合中所有的文档,<code>{属性:值}</code>查询指定属性对应值的文档</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>注:</strong></p> <ul><li><p><strong>在开发时绝对不会执行不带条件的查询</strong></p></li> <li><p>find()的结果返回是一个数组,可以加上[0]等来查找指定的第几个文档</p></li> <li><p>在后面可以加上<code>count()或length()</code>可以返回一共查找到的文档数量</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>在后面可以加上<code>pretty()</code>来格式化查询到的对象,便于观察结果</p></li> <li><p>在后面可以使用<code>limit()</code>来限制显示文档的数量</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示找到的从第一到第十条数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>在后面可以使用<code>skip()</code>来跳过指定数量的数据,常和l<code>imit()</code>配合使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示找到的从第十到第二十条数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>**注意:**按照常规的逻辑应该是先用<code>skip()</code>再用<code>limit()</code>,但是如果两者交换了顺序mongodb也会进行自动的调整(如果在其中加入了<code>sort()</code>也会先执行<code>sort()</code>再执行其他两个)</p></li> <li><p>在后面加上<code>populate()</code>可以进行查询关联,查询可以关联到其他的集合</p></li> <li><p>查询文档时,默认是按照<code>_id</code>的值进行升序排列,如果需要按照自己指定的顺序进行查询的排列,需要用<code>sort()</code>来指定排序的规则,<code>sort()</code>需要传递一个对象来指定排序规则,1表示升序,-1表示降序</p> <p>**注:**可以在一个对象中传递多个排序规则,按照从左到右的规则进行排序,如果一样就按照下一个规则排序</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>**mongodb支持直接通过内嵌文档的属性进行查询,**如果要查询内嵌文档则可以直接用<code>第一个文档的属性名.第二个文档的属性名</code>的形式来匹配(类似于JS的对象嵌套),此时的属性名必须要带上引号</p></li> <li><p>如果要对查找的文档的属性进行大小等限制时,传入对象的属性值就为一个对象,该对象里面可以包含以下<strong>修饰操作符</strong>:</p> <ul><li><p><code>$gt</code><em>(&gt;)</em>,<code>$gte</code><em>(&gt;=)</em>,<code>$lt</code><em>(&lt;)</em>,<code>$lte</code><em>(&lt;=)</em>,<code>$ne</code><em>(!=)</em>,<code>$eq</code><em>(==)</em></p> <p>**注:**这些关系表示符都可以在对象中写多个,进行多条件的限制查找</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$lt</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token literal-property property">$gt</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>$or</code>在查询的时候可以表示或者的关系,放在最外层的对象属性中,其属性是一个数组</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">$or</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$lt</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$gt</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//age大于25或小于18</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p>在查询时,可以在<code>find()</code>中传入第二个参数,在该参数位置设置查询结果的投影,设置了后就只会查询到的信息的指定结果,1代表显示该信息,0代表不显示</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查询到的结果只会显示age和_id(默认的)</span>
db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查询结果只会显示age</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li> <li><p><code>db.&lt;collection&gt;.findOne()</code>,用来查询集合中符合条件的第一个文档,返回的是一个文档对象,所以可以直接<code>.属性名</code>查询到对应的属性值</p></li></ul> <h4 id="_4-2-3-修改文档"><a href="#_4-2-3-修改文档" class="header-anchor">#</a> 4.2.3 修改文档</h4> <ul><li><p><code>db.&lt;collection&gt;.update(查询条件,新对象)</code></p> <p><strong>注意:</strong></p> <ul><li>update()默认会使用新对象替换旧对象,如果要修改指定的属性,而不是替换需要使用<strong>修改操作符</strong> <ul><li><code>$set</code>可以用来修改文档的指定属性</li> <li><code>$unset</code>可以用来删除文档的指定属性</li> <li><code>$push</code>可以向一个数组的文档属性中添加一个新的元素(可以添加相同的元素)</li> <li><code>$addToSet</code>可以向一个数组的文档属性中添加一个新的元素(不可以添加相同的元素,如果匹配到了不会加到数组里面去)</li> <li><code>$inc</code>可以将一个文档的指定属性值进行自增修改</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">gender</span><span class="token operator">:</span><span class="token string">&quot;男&quot;</span><span class="token comment">//只将gender属性加进去了,而其他两个属性依然还在</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$unset</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token number">1</span><span class="token comment">//因为是删除属性,所以后面的数据不管是什么都可以</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$inc</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//年龄自增2,如果要减2则前面加-号</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><strong>update()默认只会修改第一个符合条件的文档,如果想要修改多个文档,需要传入第三个对象参数,并在其中的<code>multi</code>属性中写上true</strong></li></ul></li> <li><p><code>db.&lt;collection&gt;.updateOne(查询条件,新对象)</code>,修改一个符合条件的文档</p></li> <li><p><code>db.&lt;collection&gt;.updateMany(查询条件,新对象)</code>,同时修改多个符合条件的文档</p></li></ul> <h4 id="_4-2-4-删除文档"><a href="#_4-2-4-删除文档" class="header-anchor">#</a> 4.2.4 删除文档</h4> <ul><li><p><code>db.&lt;collection&gt;.remove()</code>,删除符合条件的所有的文档,<strong>如果不传入参数就会报错,如果传入的是一个空的对象,则会将所有的文档都删除</strong></p> <p>**注意:**remove()默认情况下会删除所有复合条件的文档,如果只想删除第一个符合条件的文档,需要再给remove()传入第二个参数,该参数为一个布尔值,设置为true就为只删除第一个符合条件的文档</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//情况呢整个集合,但是性能较差</span>
<span class="token comment">//如果真的想把一整个集合删除,使用下面的方式</span>
db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//该方法会直接将一个集合删除</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><code>db.&lt;collection&gt;.deleteOne()</code>,删除集合中的第一个复合条件的文档</p></li> <li><p><code>db.&lt;collection&gt;.deleteMany()</code>,删除集合中的所有复合条件的文档</p></li> <li><p><code>db.&lt;collection&gt;.drop()</code>,删除集合</p></li> <li><p><code>db.dropDatabase</code>,删除数据库</p></li></ul> <p>**注意:**一般数据库中的数据不会删除,所以删除的方法很少调用,一般会在数据库中添加一个字段来表示数据是否被删除</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//如下面用isDel属性表示是否删除了某个文档</span>
db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">isDel</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">isDel</span><span class="token operator">:</span><span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">isDel</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>**注:**数据库的方法调用的时候尽量少调用,因为会非常的消耗性能,如果要连续插入很多的数据,最好先装在一个数组中再将整个数组传入到数据库中</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//如同时向数据库中插入20000条数据</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">20000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">num</span><span class="token operator">:</span>i<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//花费7.2s</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">20000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//花费0.4s</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_5-文档间的关系"><a href="#_5-文档间的关系" class="header-anchor">#</a> 5.文档间的关系</h2> <ul><li><p><strong>一对一</strong>,通过内嵌文档的形式体现出一对一的关系</p></li> <li><p><strong>一对多/多对一</strong>,通过内嵌文档来映射一对多的关系(通过联表的文档查询)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> user_id<span class="token operator">=</span>db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_id<span class="token punctuation">;</span><span class="token comment">//在这获取到独立的_id</span>
db<span class="token punctuation">.</span>order<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;苹果&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">user_id</span><span class="token operator">:</span>user_id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>order<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">user_id</span><span class="token operator">:</span>user_id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过两个文档的链接可以实现一对多的关系,通过_id进行查询</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><strong>多对多</strong>,通过数组形式的内嵌文档来映射一对多的关系(通过联表的文档查询)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> user_id1<span class="token operator">=</span>db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
<span class="token keyword">var</span> user_id2<span class="token operator">=</span>db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
db<span class="token punctuation">.</span>order<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;苹果&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">user_id</span><span class="token operator">:</span><span class="token punctuation">[</span>user_id1<span class="token punctuation">,</span>user_id2<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>order<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;苹果&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h2 id="_6-mongodb聚合管道"><a href="#_6-mongodb聚合管道" class="header-anchor">#</a> 6.Mongodb聚合管道</h2> <p><strong>使用聚合管道可以对集合中的文档进行变换和组合</strong></p> <p>**具体用法:**使用aggregate()函数进行查询,内部传入一个数组作为参数,数组中是一个个聚合管道的对象,实现对应的功能</p> <p>**实际项目:**表的关联查询、数据的统计</p> <table><thead><tr><th>管道操作符</th> <th>描述</th></tr></thead> <tbody><tr><td>$project</td> <td>增加、删除、重命名字段</td></tr> <tr><td>$math</td> <td>条件匹配,只有满足条件的文档才能进入下一阶段</td></tr> <tr><td>$limit</td> <td>限制结果的数量</td></tr> <tr><td>$skip</td> <td>跳过文档的数量</td></tr> <tr><td>$sort</td> <td>条件排序</td></tr> <tr><td>$group</td> <td>条件组合结果</td></tr> <tr><td>$sum</td> <td>求和,计算选中的数量,通过赋值每满足一个文档就会增加相应的数量</td></tr> <tr><td>$lookup</td> <td>用于引入其它集合的数据</td></tr></tbody></table> <h3 id="_6-1-project"><a href="#_6-1-project" class="header-anchor">#</a> 6.1 $project</h3> <p><strong>修改文档的结构,可以用来重命名、增加或删除文档中的字段</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$project</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">trade_no</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">all_price</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
        <span class="token comment">//会查询出同时含有这两个属性的文档,同时查找出来的文档只会显示出这两个属性</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_6-2-match"><a href="#_6-2-match" class="header-anchor">#</a> 6.2 $match</h3> <p><strong>用于过滤文档,用法类似find()方法中的参数</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$project</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">trade_no</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">all_price</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$match</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;all_price&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$gte</span><span class="token operator">:</span><span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token comment">//查找大于90价格的文档,该查询的初始数据是由上面的对象筛选下来的</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_6-3-group"><a href="#_6-3-group" class="header-anchor">#</a> 6.3 $group</h3> <p><strong>将集合中的文档进行分组,可用于统计结果</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$ground</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token string">&quot;$order_id&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">total</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$sum</span><span class="token operator">:</span><span class="token string">&quot;$num&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token comment">/*
        	将所有order_id相同的文档进行分组,分组后的一组属性的属性值有_id和total(都是自己设置),然			 后用$sum聚合管道将所有组的num属性值加起来赋值给新的total属性
        	注意:这里面只依据了order_id进行分组,total不是用来分组的
    	*/</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_6-4-sort"><a href="#_6-4-sort" class="header-anchor">#</a> 6.4 $sort</h3> <p><strong>将集合中的文档进行排序</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$project</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">trade_no</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">all_price</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$match</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;all_price&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$gte</span><span class="token operator">:</span><span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$sort</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;all_price&quot;</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token comment">//-1表示降序排序,1为升序排列</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_6-5-limit"><a href="#_6-5-limit" class="header-anchor">#</a> 6.5 $limit</h3> <p><strong>对查找到集合中的文档进行数量限制</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$project</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">trade_no</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">all_price</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$match</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;all_price&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$gte</span><span class="token operator">:</span><span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$sort</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;all_price&quot;</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token comment">//-1表示降序排序,1为升序排列</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$limit</span><span class="token operator">:</span><span class="token number">1</span><span class="token comment">//只返回一条数据</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_6-6-skip"><a href="#_6-6-skip" class="header-anchor">#</a> 6.6 $skip</h3> <p><strong>对查找到的集合中的文档进行一定的跳过忽略</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$project</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">trade_no</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">all_price</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$match</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;all_price&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$gte</span><span class="token operator">:</span><span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$sort</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;all_price&quot;</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token comment">//-1表示降序排序,1为升序排列</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$skip</span><span class="token operator">:</span><span class="token number">1</span><span class="token comment">//跳过第一条数据,也就是说拿到的数据库中的文档默认是从第二条数据开始的</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_6-7-lookup"><a href="#_6-7-lookup" class="header-anchor">#</a> 6.7 $lookup</h3> <p><strong>用于进行有关联集合的查找</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//单表关联</span>
db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$lookup</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//下面的写法左边为固定写法</span>
            <span class="token literal-property property">from</span><span class="token operator">:</span><span class="token string">&quot;test2&quot;</span><span class="token punctuation">,</span><span class="token comment">//从哪个关联的集合中查找</span>
            <span class="token literal-property property">localField</span><span class="token operator">:</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span><span class="token comment">//该集合中的关联项,名字只要相互对应就可以了</span>
            <span class="token literal-property property">foreignField</span><span class="token operator">:</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span><span class="token comment">//关联集合的关联项</span>
            <span class="token keyword">as</span><span class="token operator">:</span><span class="token string">&quot;items&quot;</span><span class="token comment">//自定义的属性</span>
            <span class="token comment">/*
            在关联集合中找到的文档会在返回结果的文档中的items属性中存在(作为一个自定义新增的属性),该			值为一个数组,查找到的关联集合中的文档为一个个对象成员
        	*/</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//多表关联</span>
db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$lookup</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">from</span><span class="token operator">:</span><span class="token string">&quot;test2&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">localField</span><span class="token operator">:</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">foreignField</span><span class="token operator">:</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">as</span><span class="token operator">:</span><span class="token string">&quot;items&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$lookup</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">from</span><span class="token operator">:</span><span class="token string">&quot;test3&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">localField</span><span class="token operator">:</span><span class="token string">&quot;order_id2&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">foreignField</span><span class="token operator">:</span><span class="token string">&quot;order_id2&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">as</span><span class="token operator">:</span><span class="token string">&quot;items2&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_7-mongoose"><a href="#_7-mongoose" class="header-anchor">#</a> 7.Mongoose</h2> <h3 id="_7-1-下载安装mongoose"><a href="#_7-1-下载安装mongoose" class="header-anchor">#</a> 7.1 下载安装Mongoose</h3> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>npm i mongoose --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_7-2-在项目中引入mongoose"><a href="#_7-2-在项目中引入mongoose" class="header-anchor">#</a> 7.2 在项目中引入Mongoose</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//导入mongoose</span>
<span class="token keyword">var</span> mongoose<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//链接mongosedb数据库</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;mongodb://数据库的ip地址:端口号/数据库名&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">userNewUrlParser</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//如果端口号是默认端口号(27017)则可以省略不写</span>

<span class="token comment">//断开数据库链接(一般不需要调用)</span>
<span class="token comment">//mongodb数据库,一般情况下,只需要连接一次,连接一次后除非项目停止服务器关闭,否则连接一般不会断开</span>
mongoose<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
	监听mongodb数据库的连接状态:在mongoose对象中,有一个connection属性,该对象表示的就是数据库连接,	 通过监视该对象的状态,可以来监听数据库的连接与断开
*/</span>
<span class="token comment">//数据库连接成功的事件</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_7-3-创建模型"><a href="#_7-3-创建模型" class="header-anchor">#</a> 7.3 创建模型</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//将mogoose.Schema赋值给一个变量</span>
<span class="token keyword">var</span> Sechema<span class="token operator">=</span>mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>
<span class="token comment">//创建Schema(模式)对象</span>
<span class="token keyword">var</span> blogSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//限制属性值</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span>  String<span class="token punctuation">,</span>
    <span class="token literal-property property">author</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span>   String<span class="token punctuation">,</span>
    <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">body</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> Date <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Date<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> Date<span class="token punctuation">.</span>now <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//可以有默认值,用默认值时是这种写法</span>
    <span class="token literal-property property">hidden</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">votes</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
        <span class="token literal-property property">favs</span><span class="token operator">:</span>  Number
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">authod_id</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId
        <span class="token comment">//类型是一个ObjectId,在创建实例模型的时候可以直接传输ID字符串,会自动转换为ObjectId</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blogModel<span class="token operator">=</span>mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;blog&quot;</span><span class="token punctuation">,</span>blogSchema<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//默认会在数据库中建立一个复数形式的blog集合</span>
<span class="token comment">//如果想要指定集合名字,可以传入第三个字符串参数,该参数的就是创建的集合名字</span>
blogMode<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">&quot;我的博客&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">author</span><span class="token operator">:</span><span class="token string">&quot;Coloring&quot;</span><span class="token comment">//假设只用填这两个</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;插入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>另一种写法</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//另一种方式</span>
<span class="token keyword">const</span> mongoose<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//连接mongodb服务器</span>
<span class="token comment">//通过这种方式返回一个对象</span>
<span class="token keyword">const</span> db<span class="token operator">=</span>mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>
    <span class="token string">&quot;mongodb://localhost:27017/数据库名&quot;</span><span class="token punctuation">,</span><span class="token comment">//有就会直接连接,没有就会在数据库创建并连接</span>
    <span class="token punctuation">{</span><span class="token literal-property property">userNewUrlParser</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//用原生ES6的Promise取代mongoose自实现的Promise</span>
mongoose<span class="token punctuation">.</span>Promise<span class="token operator">=</span>global<span class="token punctuation">.</span>Promise<span class="token punctuation">;</span>
<span class="token comment">//注意:在使用数据库之前,需要使用Schema设置每个字段的数据类型</span>

<span class="token comment">//将mogoose.Schema赋值给一个变量</span>
<span class="token keyword">const</span> Sechema<span class="token operator">=</span>mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>

<span class="token comment">//创建Schema(模式)对象</span>
<span class="token keyword">const</span> blogSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//限制属性值</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span>  String<span class="token punctuation">,</span>
    <span class="token literal-property property">author</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span>   String<span class="token punctuation">,</span>
    <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">body</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> Date <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Date<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> Date<span class="token punctuation">.</span>now <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//可以有默认值,用默认值时是这种写法</span>
    <span class="token literal-property property">hidden</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">votes</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
        <span class="token literal-property property">favs</span><span class="token operator">:</span>  Number
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> blogModel<span class="token operator">=</span>mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;blog&quot;</span><span class="token punctuation">,</span>blogSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
默认会在数据库中建立一个复数形式的blog集合
如果想要指定集合名字,可以传入第三个字符串参数,该参数的就是创建的集合名字
*/</span>
<span class="token keyword">const</span> d1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">blogModel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">&quot;我的博客&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">author</span><span class="token operator">:</span><span class="token string">&quot;Coloring&quot;</span><span class="token comment">//假设只用填这两个</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

d1<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//因为在之前用mongoose.Promise=global.Promise;所以现在可以用ES6的语法</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h4 id="_7-3-1-mongoose修辞符"><a href="#_7-3-1-mongoose修辞符" class="header-anchor">#</a> 7.3.1 mongoose修辞符</h4> <ul><li><p>**trim:**内置修饰符,用于将传入的String类型的数据进行去除两端的空格</p></li> <li><p>**set:**自定义修辞符函数,用于用户自己定义传入后的参数的变化</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> blogSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//限制属性值</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>String<span class="token punctuation">,</span>
        <span class="token literal-property property">trim</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function">ser</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//自定义修辞符,将传入name属性进行自定义的改变,第一个形参就是对应的属性</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_7-3-2-mongoose校验参数"><a href="#_7-3-2-mongoose校验参数" class="header-anchor">#</a> 7.3.2 mongoose校验参数</h4> <ul><li><p><strong>内置校验参数</strong></p> <ul><li>**type:**指定类型</li> <li>**require:**表示这个数据必须传入</li> <li>**max:**用于Number类型数据的最大值</li> <li>**min:**用于Number类型数据的最小值</li> <li>**maxlength:**字符串最大值,注意的是这个参数和下面四个参数都是用于String类型的</li> <li>**minlength:**字符串最小值</li> <li>**enum:**枚举类型,要求数据必须为枚举值,如<code>enum:['0','1','2']</code></li> <li>**match:**增加的数据必须符合match(正则)的规则</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> blogSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//限制属性值</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>String<span class="token punctuation">,</span>
        <span class="token literal-property property">require</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxlength</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minlength</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token keyword">enum</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//传入的数据必须为张三或者李四，</span>
        <span class="token literal-property property">match</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^zhangsan$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span>  <span class="token comment">//math的值应该是一个正则表达式</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>Number<span class="token punctuation">,</span>
        <span class="token literal-property property">require</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">max</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token literal-property property">min</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p><strong>自定义校验参数</strong></p> <ul><li><p>**validate:**该值应该赋值为一个函数,第一个形参就是要校验的属性</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> blogSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//限制属性值</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>String<span class="token punctuation">,</span>
        <span class="token function-variable function">validate</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> val<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//如果返回false代表验证失败</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul></li></ul> <h4 id="_7-3-3-mongoose设置索引"><a href="#_7-3-3-mongoose设置索引" class="header-anchor">#</a> 7.3.3 mongoose设置索引</h4> <ul><li>**index:**设置普通索引,设置后就可以使用<code>Model.getIndexes</code>依靠设置的索引查找到对应的文档</li> <li>**unique:**设置唯一索引,唯一索引的值在数据库中只能出现一次,不能够像普通索引一样可以是相同的值</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> blogSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//限制属性值</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>String<span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>Number<span class="token punctuation">,</span>
        <span class="token literal-property property">unique</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_7-4-model的方法"><a href="#_7-4-model的方法" class="header-anchor">#</a> 7.4 Model的方法</h3> <h4 id="_7-4-1-创建文档"><a href="#_7-4-1-创建文档" class="header-anchor">#</a> 7.4.1 创建文档</h4> <p><strong>使用Model.create()用来创建一个或多个文档并添加到数据库中</strong></p> <p><strong>参数:</strong></p> <ul><li>doc(s),可以是一个文档对象,也可以是一个包含文档对象的数组</li> <li>callback,当操作完成以后调用的回调函数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Candy<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'jelly bean'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'snickers'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> jellybean<span class="token punctuation">,</span> snickers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'jelly bean'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'snickers'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Candy<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> candies</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// ...</span>

  <span class="token keyword">var</span> jellybean <span class="token operator">=</span> candies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//第二个参数是插入的文档</span>
  <span class="token keyword">var</span> snickers <span class="token operator">=</span> candies<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 可以不写回调函数而写Promise的形式</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> Candy<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'jawbreaker'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">jawbreaker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_7-4-2-查询文档"><a href="#_7-4-2-查询文档" class="header-anchor">#</a> 7.4.2 查询文档</h4> <ul><li><p><strong>Model.find(conditions,[projection],[options],[callback])查询所有符合条件的文档,结果总会返回一个数组</strong></p> <p><strong>参数:</strong></p> <ul><li><p>condions,查询的条件</p> <p>**注:**如果传入的是一个空对象会返回所有的文档</p></li> <li><p>projection,投影,拿到需要获取到的字段,该参数有两种写法</p> <ul><li>**对象写法,**同使用原始的mongodb查询数据一样,1代表显示,0代表不显示,默认显示_id,如<code>{name:1, _id:0}</code></li> <li>**字符串写法,**用空格当分割符,如果写了就代表要投影出该属性,默认显示_id,如果不想显示在前面添加<code>-</code>号,如<code>&quot;name - _id&quot;</code></li></ul></li> <li><p>options,查询选项,如skip,limit等填写在该对象中,如<code>{skip:3,limit:1}</code></p></li> <li><p>callback,回调函数,查询结果会通过回调函数返回,<strong>回调函数必须传</strong>,如果不传回调函数,该查询方法不会进行,该回调函数的<strong>第一个参数是错误参数,第二个参数是查询到的文档</strong></p></li> <li><p>所以增删改查方法都会返回一个Promise对象,所以可以用<code>then()</code>来接收后续代码</p></li></ul></li> <li><p><strong>Model.findById(id(string),[projection],[options],[callback])根据文档的ID查询文档,返回一个对象</strong></p> <p>**注:**该函数通过传入文档的字符串id进行查询</p></li> <li><p><strong>Model.findOne(conditions,[projection],[options],[callback])查询所有符合条件的第一个文档,总会返回一个具体的文档对象</strong></p></li></ul> <p><strong>注意:</strong></p> <ul><li>通过find()等查询到的结果返回的对象就是Document文档对象,Document就是Model的实例</li> <li>在mongoose中不能直接通过<code>_id:&quot;具体ID字符串&quot;</code>的进行查找文档,必须使用对应查找ID的API或者使用<code>mongoose.Types.ObjectId(&quot;ObjectId字符串&quot;)</code>封装成一个ObjectId对象来查找</li></ul> <h4 id="_7-4-3-修改文档"><a href="#_7-4-3-修改文档" class="header-anchor">#</a> 7.4.3 修改文档</h4> <ul><li><p><strong>Model.update(conditions,doc,[options],[callback])用来修改一个或多个文档</strong></p> <p><strong>参数:</strong></p> <ul><li>condions,查询条件</li> <li>doc,修改后的对象</li> <li>options,配置参数</li> <li>callback,回调函数</li></ul></li> <li><p><strong>Model.updateOne(conditions,doc,[options],[callback])</strong></p></li> <li><p><strong>Model.updateMany(conditions,doc,[options],[callback])</strong></p></li> <li><p><strong>Model.replaceOne(conditions,doc,[options],[callback])</strong>,该函数不用传入<code>$set</code>来修改指定值,只需要传入要修改的对象就可以了</p></li> <li><p><strong>Model.findByIdAndUpdate(_id,doc,[options],[callback])</strong>,根据ID进行查找和更新</p></li></ul> <h4 id="_7-4-4-删除文档"><a href="#_7-4-4-删除文档" class="header-anchor">#</a> 7.4.4 删除文档</h4> <ul><li><strong>Model.remove(conditions,[callback]),默认删除多个文档,如果只想删除一个把conditons中的single设置为true</strong></li> <li><strong>Model.deleteOne(conditions,[callback])</strong></li> <li><strong>Model.deleteMany(conditions,[callback])</strong></li> <li><strong>Model.findByIdAndRemove(id,[callback])</strong></li></ul> <h4 id="_7-4-5-计算文档总数"><a href="#_7-4-5-计算文档总数" class="header-anchor">#</a> 7.4.5 计算文档总数</h4> <p><strong>Model.count(conditions,[callbcak])能计算查询到的文档总数,该值在callback的第二个参数中</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Candy<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>count</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_7-4-6-moogoose聚合管道"><a href="#_7-4-6-moogoose聚合管道" class="header-anchor">#</a> 7.4.6 moogoose聚合管道</h4> <p><strong>moogoose中的聚合管道与原生的mongodb中的聚合管道用法类似,只需要用<code>Model.aggregate()</code>内部传入同样的管道操作符即可</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Candy<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$lookup</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//下面的写法左边为固定写法</span>
            <span class="token literal-property property">from</span><span class="token operator">:</span><span class="token string">&quot;test2&quot;</span><span class="token punctuation">,</span><span class="token comment">//从哪个关联的集合中查找</span>
            <span class="token literal-property property">localField</span><span class="token operator">:</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span><span class="token comment">//该集合中的关联项,名字只要相互对应就可以了</span>
            <span class="token literal-property property">foreignField</span><span class="token operator">:</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span><span class="token comment">//关联集合的关联项</span>
            <span class="token keyword">as</span><span class="token operator">:</span><span class="token string">&quot;items&quot;</span><span class="token comment">//自定义的属性</span>
            <span class="token comment">/*
            在关联集合中找到的文档会在返回结果的文档中的items属性中存在(作为一个自定义新增的属性),该			值为一个数组,查找到的关联集合中的文档为一个个对象成员
        	*/</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$lookup</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">from</span><span class="token operator">:</span><span class="token string">&quot;test3&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">localField</span><span class="token operator">:</span><span class="token string">&quot;order_id2&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">foreignField</span><span class="token operator">:</span><span class="token string">&quot;order_id2&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">as</span><span class="token operator">:</span><span class="token string">&quot;items2&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">$match</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span>mongoose<span class="token punctuation">.</span>Types<span class="token punctuation">.</span><span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5d11b5e3ec794933d42f67e8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token comment">//在mongoose中使用mongoose.Types.ObjectId(&quot;ObjectId字符串&quot;)来查找Objectid</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringfy</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_7-4-7-文档关联查询"><a href="#_7-4-7-文档关联查询" class="header-anchor">#</a> 7.4.7 文档关联查询</h4> <ul><li><p><strong>mongoose大于3.2以上的版本推荐使用mongodb中的聚合管道的$lookup进行管理查询</strong></p></li> <li><p><strong>mongoose自己实现了一个强大的关联查询的方法<code>populate()</code>实现表的关联查询</strong></p> <p><strong>注意:</strong></p> <ul><li>使用populate()方法需要引用所有用的的Model到同一个文件中</li> <li>该方法常和<code>exec()</code>方法一起使用,exec()方法相当于then()方法,是前面所有方法执行完后才会执行,传入一个回调函数,第一个参数是错误对象,第二个参数是查询到的文档数组对象</li> <li>该方法使用时需要在Schema中的要被关联文档替代的属性设置<code>{type: Schema.Types.ObjectId, ref: '要关联的集合'}</code></li></ul> <p><strong>Model中的用法:</strong><code>Model.populate(path, [select], [model], [match], [options])</code></p> <ul><li><p>**path:**类型为<code>String</code>或<code>Object</code></p> <ul><li><code>String</code>类型的时, 指定要填充的关联字段,要填充多个关联字段可以以空格分隔。</li> <li><code>Object</code>类型的时,就是把 <strong>populate</strong> 的参数封装到一个对象里。当然也可以是个数组,用于多个文档的关联查找</li></ul></li> <li><p>**select:**类型为<code>Object</code>或<code>String</code>,可选,指定填充document文档中的哪些字段</p> <ul><li><code>Object</code>类型的时,格式如:<code>{name: 1, _id: 0}</code>,为<strong>0</strong>表示不填充,为<strong>1</strong>时表示填充</li> <li><code>String</code>类型的时,格式如:<code>&quot;name -_id&quot;</code>,用空格分隔字段,在字段名前加上<code>-</code>表示不填充</li></ul> <p>**注:**详细语法介绍 <a href="http://mongoosejs.com/docs/api.html#query_Query-select" target="_blank" rel="noopener noreferrer">query-select<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>**model:**类型为<code>Model</code>,可选,指定关联字段的model(所以如果没有在Schema中指定ref也是能进行操作的),如果没有指定就会使用<code>Schema</code>的<code>ref</code></p></li> <li><p>**match:**类型为<code>Object</code>,可选,指定附加的查询条件</p></li> <li><p>**options:**类型为<code>Object</code>,可选,指定附加的其他查询选项,如排序以及条数限制等等</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Schema   <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>

<span class="token keyword">var</span> UserSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span>  <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">posts</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">'Post'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token comment">//关联多个帖子用数组,固定写法</span>
    <span class="token comment">/*
    ref是用于指定关联的数据库,在使用populate方法的时候只需要传入要替换的字段,就能通过该字段属性在	 Schema中的ref指定的关联文档进行查找,一般该属性传入的是一个ObjectId,所以类型是ObjectId,通过	这种方式就可以通过查找传入的ObjectId的字符串查找到对应的关联文档,查找到的文档会直接覆盖掉这个		属性原来的值,这样达到查找关联的效果
    */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> User <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> UserSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> PostSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">poster</span>   <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">'User'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">comments</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">'Comment'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">title</span>    <span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">content</span>  <span class="token operator">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Post <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Post'</span><span class="token punctuation">,</span> PostSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> CommentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">post</span>      <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&quot;Post&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">commenter</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">'User'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">content</span>   <span class="token operator">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Comment <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Comment'</span><span class="token punctuation">,</span> CommentSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//传入数据</span>
<span class="token keyword">var</span> user <span class="token operator">=</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> post1 <span class="token operator">=</span> Post<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">&quot;第一篇帖子&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> post2 <span class="token operator">=</span> Post<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">&quot;第二篇帖子&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>posts<span class="token operator">=</span><span class="token punctuation">[</span>post1<span class="token punctuation">,</span>post2<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//设置一对多的关联</span>
<span class="token comment">//设置关联,可以直接把整个对象关联,会直接将这个对象的ObjectId存入,也可以直接[post1_id,post2_id]</span>
post1<span class="token punctuation">.</span>poster<span class="token operator">=</span>user<span class="token punctuation">;</span>
<span class="token comment">//设置一对一的关联,因为上面设置的时候不是一个数组,所以只能设置一个,可以直接user_id</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//填充所有 users 的 posts</span>
User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">sort</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> docs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>posts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// post-by-aikin</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//填充 user 'luajin'的 posts</span>
User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'luajin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'posts'</span><span class="token punctuation">,</span> <span class="token literal-property property">select</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">sort</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>posts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// post-by-luajin</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//这里的 populate 方法传入的参数形式不同，其实实现的功能是一样的，只是表示形式不一样。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>Post<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'post-by-aikin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'poster comments'</span><span class="token punctuation">,</span> <span class="token string">'-_id'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>poster<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// aikin</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>poster<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// undefined</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>comments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// comment-by-luna</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>comments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Post<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'post-by-aikin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'poster comments'</span><span class="token punctuation">,</span> <span class="token literal-property property">select</span><span class="token operator">:</span> <span class="token string">'-_id'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>poster<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// aikin</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>poster<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// undefined</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>comments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// comment-by-luna</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>comments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//上两种填充的方式实现的功能是一样的。就是给 populate 方法的参数不同。</span>
<span class="token comment">//这里要注意，当两个关联的字段同时在一个 path 里面时,select 必须是 document(s)具有的相同字段。</span>


<span class="token comment">//如果想要给单个关联的字段指定 select,可以传入数组的参数。如下：</span>

Post<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'post-by-aikin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'poster'</span><span class="token punctuation">,</span> <span class="token string">'comments'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>poster<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// aikin</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>comments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// comment-by-luna</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Post<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'post-by-aikin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">'poster'</span><span class="token punctuation">,</span>   <span class="token literal-property property">select</span><span class="token operator">:</span> <span class="token string">'-_id'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span><span class="token string">'comments'</span><span class="token punctuation">,</span> <span class="token literal-property property">select</span><span class="token operator">:</span> <span class="token string">'-content'</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>poster<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// aikin</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>poster<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// undefined</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>comments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 会打印出对应的 comment id</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>comments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div></li></ul> <h5 id="_7-4-7-1-文档关联高级用法"><a href="#_7-4-7-1-文档关联高级用法" class="header-anchor">#</a> 7.4.7.1 文档关联高级用法</h5> <p><strong>使用populate()进行文档关联的时候也可以像聚合管道一样进行高级关联</strong></p> <p>**比如:**被关联的类别也可以拿到关联它的关联项,实现一对多的用法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Post<span class="token operator">=</span>mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;Post&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>String	
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>String
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">categories</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>mongoose<span class="token punctuation">.</span>SchemaTypes<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span><span class="token literal-property property">ref</span><span class="token operator">:</span><span class="token string">&quot;Category&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> CategorySchema<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>String<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">toJSON</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">virtuals</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token comment">//调用toJSON方法时默认会把虚拟字段加上,与express的res.send()配合</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//想要获取关联词类别的的posts,需要定义一个虚拟字段</span>
<span class="token comment">//设置虚拟字段</span>
CategorySchema<span class="token punctuation">.</span><span class="token function">virtul</span><span class="token punctuation">(</span><span class="token string">&quot;posts&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token comment">//posts是设置的虚拟的属性</span>
    <span class="token literal-property property">ref</span><span class="token operator">:</span><span class="token string">&quot;Post&quot;</span><span class="token punctuation">,</span><span class="token comment">//要关联的集合</span>
    <span class="token literal-property property">localField</span><span class="token operator">:</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">,</span><span class="token comment">//自身要关联的字段</span>
    <span class="token literal-property property">foreignField</span><span class="token operator">:</span><span class="token string">&quot;categories&quot;</span><span class="token punctuation">,</span><span class="token comment">//对方集合要关联的字段</span>
    <span class="token literal-property property">justOne</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token comment">//表示查出来的数据是否只有一条,如果是false返回数组,如果是true返回对象</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//要先设置虚拟字段再创建模型</span>
<span class="token keyword">const</span> Catagory<span class="token operator">=</span>mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;Category&quot;</span><span class="token punctuation">,</span>CategorySchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

Category<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&quot;posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>docs</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//注意,因为是虚拟字段,在mongoose的机制里默认不会显示,除非加了上面的参数</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>posts<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//但是如果真实的获取会获取到它的信息</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>posts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
    因为设置了参数
    {
    toJSON:{virtuals:true}
	}
	所以调用JSON.stringify会有虚拟字段,否则不会有虚拟字段
	*/</span>
    
    <span class="token comment">//也可以使用一种更好的方法</span>
    docs<span class="token operator">=</span>docs<span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//表示将对象转换为纯JSON对象,这样就可以得到虚拟字段中的数据了</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h4 id="_7-4-8-扩展model方法"><a href="#_7-4-8-扩展model方法" class="header-anchor">#</a> 7.4.8 扩展Model方法</h4> <ul><li><p><strong>静态方法:<strong>通过对Schema的</strong>statics</strong>属性上添加静态方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>UserSchema<span class="token punctuation">.</span>statics<span class="token punctuation">.</span><span class="token function-variable function">findById</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">uid<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span>uid<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><strong>实例方法:<strong>通过对Schema的</strong>methods</strong>属性上添加实例方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>UserSchema<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function-variable function">print</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;这是一个实例方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <p>**注意:**不能按照常规类的写法来写,不然会报错</p> <h3 id="_7-5-document方法"><a href="#_7-5-document方法" class="header-anchor">#</a> 7.5 Document方法</h3> <p><strong>Document和集合中的文档一一对应,Document是Model的实例,通过Model查询到结果都是Document</strong></p> <ul><li><p>**Document.save([options].[fn]),**该方法用于将文档保存到数据库</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> candy<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Candy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;candy&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//只这样是不会保存到数据库的,还需要使用save()方法</span>
candy<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        conosole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;保存成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>**Document.update(update,[options],[callback]),**该方法用于修改对象,不过不用传入查找方式,直接修改调用该方法的文档</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Candy<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>doc</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        doc<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;修改成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>**Document.remove([callback]),**该方法用于删除当前文档对象</p></li> <li><p><strong>Document.get(name),<strong>该方法用于获取文档中的指定属性,等同于直接</strong><code>文档.属性</code></strong></p></li> <li><p><strong>Document.set(name.value),<strong>该方法用于设置文档中的指定属性值,等同于直接</strong><code>文档.属性=值</code></strong></p> <p>**注意:**使用该方法数据库中的值也不会改变,因为还没有调用save()方法</p></li> <li><p><strong>Document.id</strong>,用于获取文档的<code>_id</code>(当然直接使用Document._id也是可以获取到的)</p></li> <li><p><strong>Document.toObject()</strong>,该方法可以将一个Document对象转变为普通的对象,转变后不能再使用Document对象的方法,但是其属性能被<code>delete 属性名</code>删除,而且也不能使用Document.id获取<code>_id</code>,但是可以使用Document._id来获取</p></li></ul> <h3 id="_7-6-模块化导入数据库"><a href="#_7-6-模块化导入数据库" class="header-anchor">#</a> 7.6 模块化导入数据库</h3> <ul><li><p><strong>先定义一个模板用来连接mongodb数据库</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//connect.js</span>
<span class="token keyword">const</span> mongoose<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;mongodb://数据库的ip地址:端口号/数据库名&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">userNewUrlParser</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//如果端口号是默认端口号(27017)则可以省略不写</span>
<span class="token comment">//可以用作测试</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库链接成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><strong>定义模板创建需要的模型</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//student.js</span>
<span class="token keyword">const</span> mongoose<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Schema<span class="token operator">=</span>mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>
<span class="token keyword">let</span> Student<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span>String<span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span>Number<span class="token punctuation">,</span>
    <span class="token literal-property property">gender</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span>String<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span><span class="token string">&quot;female&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">address</span><span class="token operator">:</span>String
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> StudentModel<span class="token operator">=</span>mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">,</span>Student<span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>StudentModel<span class="token punctuation">;</span><span class="token comment">//导出模型对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p><strong>使用模型</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./connect.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//因为不用导出数据,所以可以不赋值</span>
<span class="token keyword">const</span> Student<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./student.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//测试用</span>
Student<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul></div></div> <div class="page-edit"><div class="tags"><a href="/tags/?tag=%E6%95%B0%E6%8D%AE%E5%BA%93" title="标签">#数据库</a></div> <div class="last-updated"><span class="prefix">最近更新时间：</span> <span class="time">2022/04/05 13:11:55</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="theme-vdoing-wrapper article-list bg-style-14"><div class="article-title"><a href="/archives/" class="fa fa-pencil-alt">
      最近更新
    </a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><div><a href="/pages/9fba4aa49e491/"><div>动态词云</div></a></div> <div class="date"><span>2023/07/17 13:57:35</span></div></dt></dl><dl><dd>02</dd> <dt><div><a href="/pages/9cbeeeb482705/"><div>v-watermark自定义指令</div></a></div> <div class="date"><span>2023/07/17 10:12:59</span></div></dt></dl><dl><dd>03</dd> <dt><div><a href="/pages/6e64e1b8ebb63/"><div>webSocket分装</div></a></div> <div class="date"><span>2023/07/17 09:24:52</span></div></dt></dl> <div class="more-box"><a href="/archives/" class="more"><i class="fas fa-angle-double-right"></i>前往更多 ...
      </a></div></div></div> <div class="comments-wrapper" style="display:none;"><!----></div></main></div> <div class="footer-wrapper" data-v-71a9fa70 data-v-71a9fa70><span class="footer-reco-theme" data-v-71a9fa70><i class="iconfont reco-github" data-v-71a9fa70></i> <a target="blank" href="https://github.com/LiyumingBen" data-v-71a9fa70>LiyumingBen</a></span> <!----> <span class="footer-copyright" data-v-71a9fa70><i class="iconfont reco-copyright" data-v-71a9fa70></i> <a data-v-71a9fa70><span data-v-71a9fa70>Ben</span> <span class="ml5" data-v-71a9fa70>
          2021 - 2023
        </span></a></span> <span class="footer-view-site" data-v-71a9fa70><i class="iconfont reco-eye" data-v-71a9fa70></i> <span id="busuanzi_container_site_uv" data-v-71a9fa70>
        访客数：<span id="busuanzi_value_site_uv" class="num" data-v-71a9fa70>-</span></span> <span id="busuanzi_container_site_pv" class="ml5" data-v-71a9fa70>
        访问量：<span id="busuanzi_value_site_pv" class="num" data-v-71a9fa70>-</span></span></span></div> <!----></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div></div></div></div>
    <script src="/assets/js/app.d79cf97e.js" defer></script><script src="/assets/js/2.c3fe4d6a.js" defer></script><script src="/assets/js/68.8946d160.js" defer></script><script src="/assets/js/4.35d88f9b.js" defer></script>
  </body>
</html>
